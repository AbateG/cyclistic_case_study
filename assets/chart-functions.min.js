function showLoading(chartId,message="Loading chart..."){const container=document.getElementById(chartId);if(!container)return;container.innerHTML="";const loadingDiv=document.createElement("div");loadingDiv.className="loading-container";loadingDiv.innerHTML=`\n        <div class="loading-spinner"></div>\n        <div class="loading-text">${message}</div>\n    `;container.appendChild(loadingDiv);container.classList.add("loading")}function hideLoading(chartId){const container=document.getElementById(chartId);if(container){container.classList.remove("loading")}}function showError(chartId,message="Error loading chart"){const container=document.getElementById(chartId);if(!container)return;container.innerHTML="";const errorDiv=document.createElement("div");errorDiv.className="loading-container";errorDiv.innerHTML=`\n        <div style="color: var(--accent-rose); font-size: 24px; margin-bottom: 8px;">⚠️</div>\n        <div class="loading-text" style="color: var(--accent-rose);">${message}</div>\n    `;container.appendChild(errorDiv)}function loadChartWithErrorHandling(chartFunction,chartIds,loadingMessage="Loading chart..."){chartIds.forEach(id=>showLoading(id,loadingMessage));setTimeout(()=>{try{chartFunction();chartIds.forEach(id=>hideLoading(id))}catch(error){console.error("Error loading charts:",error);chartIds.forEach(id=>{hideLoading(id);showError(id,"Failed to load chart data")})}},300)}function updateCharts(type){const rideTrace={x:rideLengths[type],type:"histogram",name:"Ride Lengths (minutes)",marker:{color:"#3498db"}};Plotly.newPlot("ride-length-chart",[rideTrace]);const dayTrace={x:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],y:daysOfWeek[type],type:"bar",name:"Rides by Day",marker:{color:"#e74c3c"}};Plotly.newPlot("day-of-week-chart",[dayTrace]);const hourTrace={x:Array.from({length:24},(_,i)=>i),y:hourlyUsage[type],type:"scatter",mode:"lines+markers",name:"Hourly Usage",line:{color:"#2ecc71"}};Plotly.newPlot("hourly-usage-chart",[hourTrace]);const heatmapData=[{z:Array.from({length:10},()=>Array.from({length:10},()=>Math.floor(Math.random()*100))),type:"heatmap",colorscale:"Viridis"}];Plotly.newPlot("station-heatmap",heatmapData)}function loadOverviewCharts(){console.log("Overview charts loaded")}function switchVizTab(tabName){document.querySelectorAll(".viz-content").forEach(tab=>{tab.classList.remove("active")});document.querySelectorAll(".viz-tab").forEach(btn=>{btn.classList.remove("active");btn.style.background="transparent";btn.style.color="var(--neutral-300)"});document.getElementById(tabName+"-tab").classList.add("active");event.target.classList.add("active");event.target.style.background="rgba(255,255,255,0.2)";event.target.style.color="white";loadTabCharts(tabName)}function loadTabCharts(tabName){switch(tabName){case"usage":loadChartWithErrorHandling(loadUsageCharts,["usage-comparison-chart","temporal-patterns-chart","revenue-impact-chart","station-preferences-chart"],"Loading usage analytics...");break;case"temporal":loadChartWithErrorHandling(loadTemporalCharts,["weekday-weekend-chart","hourly-comparison-chart","seasonal-trends-chart","growth-analysis-chart"],"Loading temporal patterns...");break;case"stations":loadChartWithErrorHandling(loadStationsCharts,["station-heatmap-chart","station-popularity-chart","route-optimization-chart","capacity-analysis-chart"],"Loading station analysis...");break;case"business":loadChartWithErrorHandling(loadBusinessCharts,["revenue-breakdown-chart","profitability-chart","market-share-chart","roi-analysis-chart"],"Loading business metrics...");break;case"conversion":loadChartWithErrorHandling(loadConversionCharts,["conversion-funnel-chart","retention-analysis-chart","lifetime-value-chart","churn-prediction-chart"],"Loading conversion insights...");break}}function loadUsageCharts(){const durationData=[{x:["Members","Casuals"],y:[12.5,25.3],type:"bar",name:"Average Ride Duration (minutes)",marker:{color:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("usage-comparison-chart",durationData,{title:"Ride Duration: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const frequencyData=[{x:["Members","Casuals"],y:[291,97],type:"bar",name:"Average Annual Rides",marker:{color:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("temporal-patterns-chart",frequencyData,{title:"Ride Frequency: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const revenueData=[{x:["Members","Casuals"],y:[24e5,669e3],type:"bar",name:"Annual Revenue ($)",marker:{color:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("revenue-impact-chart",revenueData,{title:"Revenue Impact: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const distributionData=[{values:[78,22],labels:["Members (2.4M rides)","Casuals (669K rides)"],type:"pie",marker:{colors:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("station-preferences-chart",distributionData,{title:"User Type Distribution",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function loadTemporalCharts(){const weekdayData=[{x:["Weekday","Weekend"],y:[75,25],type:"bar",name:"Member Usage %",marker:{color:"#1f77b4"}},{x:["Weekday","Weekend"],y:[35,65],type:"bar",name:"Casual Usage %",marker:{color:"#ff7f0e"}}];Plotly.newPlot("weekday-weekend-chart",weekdayData,{barmode:"group",title:"Weekday vs Weekend Usage Patterns",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const hourlyData=[{x:Array.from({length:24},(_,i)=>i),y:[8e3,5e3,3e3,2e3,3e3,15e3,35e3,55e3,45e3,35e3,3e4,35e3,4e4,45e3,5e4,55e3,5e4,35e3,25e3,15e3,1e4,8e3,6e3,5e3],type:"scatter",mode:"lines+markers",name:"Members (Commute Hours)",line:{color:"#1f77b4"}},{x:Array.from({length:24},(_,i)=>i),y:[3e3,2e3,1500,1e3,2e3,5e3,12e3,18e3,22e3,25e3,28e3,3e4,28e3,25e3,22e3,18e3,15e3,12e3,8e3,6e3,4e3,3e3,2500,2e3],type:"scatter",mode:"lines+markers",name:"Casuals (Leisure Hours)",line:{color:"#ff7f0e"}}];Plotly.newPlot("hourly-comparison-chart",hourlyData,{title:"Hourly Usage: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const seasonalData=[{x:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],y:[2e4,25e3,35e3,45e3,55e3,65e3,7e4,68e3,55e3,45e3,3e4,25e3],type:"scatter",mode:"lines+markers",name:"Total Usage",line:{color:"#2ca02c"}}];Plotly.newPlot("seasonal-trends-chart",seasonalData,{title:"Seasonal Usage Trends",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const durationHourData=[{x:Array.from({length:24},(_,i)=>i),y:Array.from({length:24},()=>12+Math.random()*3),type:"scatter",mode:"lines+markers",name:"Members (Consistent)",line:{color:"#1f77b4"}},{x:Array.from({length:24},(_,i)=>i),y:Array.from({length:24},()=>20+Math.random()*15),type:"scatter",mode:"lines+markers",name:"Casuals (Variable)",line:{color:"#ff7f0e"}}];Plotly.newPlot("duration-by-hour-chart",durationHourData,{title:"Average Ride Duration by Hour",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function createNetworkGraph(){const svg=d3.select("#network-graph-chart").append("svg").attr("width","100%").attr("height",300);const nodes=[{id:1,name:"Station A",x:100,y:100},{id:2,name:"Station B",x:200,y:150},{id:3,name:"Station C",x:150,y:200},{id:4,name:"Station D",x:250,y:100}];const links=[{source:1,target:2,value:10},{source:1,target:3,value:8},{source:2,target:4,value:6},{source:3,target:4,value:4}];svg.selectAll("line").data(links).enter().append("line").attr("x1",d=>nodes.find(n=>n.id===d.source).x).attr("y1",d=>nodes.find(n=>n.id===d.source).y).attr("x2",d=>nodes.find(n=>n.id===d.target).x).attr("y2",d=>nodes.find(n=>n.id===d.target).y).attr("stroke","#1f77b4").attr("stroke-width",d=>Math.sqrt(d.value));svg.selectAll("circle").data(nodes).enter().append("circle").attr("cx",d=>d.x).attr("cy",d=>d.y).attr("r",20).attr("fill","#ff7f0e").attr("stroke","#fff").attr("stroke-width",2);svg.selectAll("text").data(nodes).enter().append("text").attr("x",d=>d.x).attr("y",d=>d.y+5).attr("text-anchor","middle").attr("fill","white").style("font-size","10px").text(d=>d.name)}function loadSpatialCharts(){createNetworkGraph();const treemapData=[{type:"treemap",labels:["Station A","Station B","Station C","Station D","Station E","Station F"],parents:["","","","","",""],values:[100,80,60,40,30,20],textinfo:"label+value"}];Plotly.newPlot("treemap-chart",treemapData,{paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const sunburstData=[{type:"sunburst",labels:["Downtown","North Side","South Side","West Side","Station 1","Station 2","Station 3","Station 4"],parents:["","","","","Downtown","North Side","South Side","West Side"],values:[50,30,20,25,25,15,10,15]}];Plotly.newPlot("sunburst-chart",sunburstData,{paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const sankeyData={type:"sankey",node:{pad:15,thickness:20,line:{color:"black",width:.5},label:["Residential","Commercial","Parks","Transit","Morning","Evening","Weekend"]},link:{source:[0,0,1,1,2,2,3,3],target:[4,5,4,6,5,6,4,5],value:[20,10,15,5,8,12,18,7]}};Plotly.newPlot("sankey-chart",[sankeyData],{paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function loadStationsCharts(){const stationsData=[{x:["Clark/Lake","Wells/Marble Place","Millennium Park","Theater District","Michigan Ave"],y:[85e3,72e3,68e3,65e3,62e3],type:"bar",name:"Member Usage",marker:{color:"#1f77b4"}},{x:["Clark/Lake","Wells/Marble Place","Millennium Park","Theater District","Michigan Ave"],y:[25e3,18e3,45e3,42e3,35e3],type:"bar",name:"Casual Usage",marker:{color:"#ff7f0e"}}];Plotly.newPlot("top-stations-chart",stationsData,{barmode:"group",title:"Top Stations: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const heatmapData=[{z:Array.from({length:10},()=>Array.from({length:10},()=>Math.floor(Math.random()*100))),type:"heatmap",colorscale:"Blues"}];Plotly.newPlot("station-heatmap-chart",heatmapData,{title:"Station Usage Heatmap",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const routesData=[{x:["Downtown Commute","North Side Local","Lakefront Leisure","Business District","Tourist Loop"],y:[12e4,85e3,95e3,78e3,65e3],type:"bar",name:"Route Popularity",marker:{color:"#2ca02c"}}];Plotly.newPlot("popular-routes-chart",routesData,{title:"Popular Routes by Usage Type",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const utilizationData=[{x:["Transit Hubs","Business Districts","Parks & Attractions","Residential Areas"],y:[95,88,76,45],type:"bar",name:"Utilization Rate %",marker:{color:"#9467bd"}}];Plotly.newPlot("station-utilization-chart",utilizationData,{title:"Station Utilization Rates",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function loadBusinessCharts(){const revenueImpactData=[{x:["Members","Casuals","Conversion Potential"],y:[24e5,669e3,28e5],type:"bar",name:"Annual Revenue ($)",marker:{color:["#1f77b4","#ff7f0e","#2ca02c"]}}];Plotly.newPlot("revenue-impact-chart",revenueImpactData,{title:"Revenue Impact Analysis",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const ltvData=[{x:["Members (2+ years)","Casuals (3 months)"],y:[1200,150],type:"bar",name:"Lifetime Value ($)",marker:{color:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("lifetime-value-chart",ltvData,{title:"Customer Lifetime Value",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const funnelData=[{x:["All Casuals","High Potential","Contacted","Converted"],y:[100,30,10,2],type:"funnel",name:"Conversion Funnel",marker:{color:"#9467bd"}}];Plotly.newPlot("conversion-funnel-chart",funnelData,{title:"Conversion Funnel Analysis",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const profitabilityData=[{x:["High Frequency","Medium Frequency","Low Frequency"],y:[500,200,50],type:"bar",name:"Monthly Revenue per User ($)",marker:{color:"#d62728"}}];Plotly.newPlot("profitability-matrix-chart",profitabilityData,{title:"Profitability by Usage Pattern",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function loadConversionCharts(){const recommendationsData=[{x:["Weekend Campaigns","Digital Nudging","Seasonal Promotions"],y:[15,25,20],type:"bar",name:"Expected Conversion Rate %",marker:{color:"#1f77b4"}}];Plotly.newPlot("recommendations-chart",recommendationsData,{title:"Top 3 Conversion Strategies",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const digitalData=[{x:["App Notifications","Location-Based Offers","Social Proof","Email Campaigns"],y:[300,250,180,120],type:"bar",name:"Expected ROI %",marker:{color:"#ff7f0e"}}];Plotly.newPlot("digital-marketing-chart",digitalData,{title:"Digital Marketing Opportunities",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const expansionData=[{x:["Tourist Areas","Business Districts","Transit Hubs","Residential"],y:[25,20,15,10],type:"bar",name:"Ridership Increase %",marker:{color:"#2ca02c"}}];Plotly.newPlot("expansion-plan-chart",expansionData,{title:"Infrastructure Expansion Impact",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const metricsData=[{x:["Conversion Rate","CAC","LTV Increase","Revenue Growth"],y:[15,50,500,28e5],type:"bar",name:"Target Metrics",marker:{color:"#9467bd"}}];Plotly.newPlot("success-metrics-chart",metricsData,{title:"Success Metrics Dashboard",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}function updateAllCharts(){const activeTab=document.querySelector(".viz-tab.active");if(activeTab){const tabName=activeTab.textContent.toLowerCase().split(" ")[0];loadTabCharts(tabName)}}function resetFilters(){const userFilter=document.getElementById("user-filter");if(userFilter)userFilter.value="all";const timeFilter=document.getElementById("time-filter");if(timeFilter)timeFilter.value="all";const metricFilter=document.getElementById("metric-filter");if(metricFilter)metricFilter.value="duration";currentFilters={user:"all",time:"all",metric:"duration"};updateAllCharts()}function updateDashboardCharts(){const usageData=[{x:["Members","Casuals"],y:[2.4,.67],type:"bar",name:"Total Rides (Millions)",marker:{color:["#1f77b4","#ff7f0e"]}}];Plotly.newPlot("usage-comparison-chart",usageData,{title:"Total Rides: Members vs Casuals",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const temporalData=[{x:["Weekday","Weekend"],y:[75,25],type:"bar",name:"Member Usage %",marker:{color:"#1f77b4"}},{x:["Weekday","Weekend"],y:[35,65],type:"bar",name:"Casual Usage %",marker:{color:"#ff7f0e"}}];Plotly.newPlot("temporal-patterns-chart",temporalData,{barmode:"group",title:"Usage Patterns: Weekday vs Weekend",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const revenueImpactData=[{x:["Members","Casuals","Potential"],y:[2.4,.67,2.8],type:"bar",name:"Revenue (Millions $)",marker:{color:["#1f77b4","#ff7f0e","#2ca02c"]}}];Plotly.newPlot("revenue-impact-chart",revenueImpactData,{title:"Revenue Impact Analysis",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"});const stationData=[{x:["Transit Hubs","Business Districts","Parks & Attractions","Residential Areas"],y:[95,88,76,45],type:"bar",name:"Utilization Rate %",marker:{color:"#9467bd"}}];Plotly.newPlot("station-preferences-chart",stationData,{title:"Station Utilization by Type",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)"})}